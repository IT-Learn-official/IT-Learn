<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IT Learn | Account Verified</title>
  <link rel="stylesheet" href="verify-success.css" />
  <script src="/translations.js"></script>
</head>
<body>
  <div class="container">
    <h1 data-translate="emailVerified">âœ… Email Verified!</h1>
    <p class="fade-in" data-translate="verifySuccessMessage">Your account has been successfully confirmed. You can now login to continue your learning journey.</p>
    <a class="btn-login pulse" href="login.html" data-translate="goToLogin">Go to Login</a>
    <p class="redirect-text fade-in"><span data-translate="autoRedirecting">Automatically redirecting in</span> <span id="countdown">5</span> <span data-translate="seconds">seconds...</span></p>
  </div>

  <script>
    let countdown = 5;
    const countdownEl = document.getElementById("countdown");
    const interval = setInterval(() => {
      countdown--;
      countdownEl.textContent = countdown;
      if (countdown <= 0) {
        clearInterval(interval);
        window.location.href = "login.html";
      }
    }, 1000);
  </script>
  <script src="https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
  const SUPABASE_URL = 'https://YOUR-PROJECT-REF.supabase.co';
  const SUPABASE_ANON_KEY = 'YOUR_PUBLIC_ANON_KEY';

  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    auth: {
      flowType: 'pkce',
      detectSessionInUrl: true
    }
  });

  (async () => {
    const { data, error } = await supabase.auth.getSession();
    if (error || !data.session) {
      console.error('No session after OAuth', error);
      window.location.href = '/login';
      return;
    }

    const accessToken = data.session.access_token;

    const res = await fetch('https://itlearn.pythonanywhere.com/api/session-from-supabase', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      credentials: 'include',
      body: JSON.stringify({ access_token: accessToken })
    });

    if (!res.ok) {
      window.location.href = '/login';
      return;
    }

    window.location.href = '/';
  })();
</script>
</body>
</html>
